## P4-F01 — MODERATOR (telemetry broker)
status: META
owner: system
req_type: FUNCTIONAL
phase: runtime
area: MODERATOR
priority: H
labels: [moderator, logging, orchestration]
rationale: The moderator persona collects structured telemetry so other personas and external tools (including AI assistants) can analyse system behaviour.
acceptance:
  - The moderator exposes lifecycle APIs to start/end logging sessions scoped to simulation ticks.
  - Telemetry events include actor/configurator context, decision tiers, outcomes, and correlation identifiers so downstream consumers can trace causality.
  - Output is recorded in both human-readable (ASCII snapshot) and machine-readable (JSON/JSONL) formats.
verification:
  - design review: confirm schema coverage for actor/configurator events and compatibility with external tooling.
traces:
  code: []

## P4-F02 — MODERATOR STATES (state machine orchestration)
status: META
owner: system
req_type: FUNCTIONAL
phase: runtime
area: MODERATOR
priority: M
labels: [moderator, lifecycle]
rationale: The moderator runs as a state machine with lifecycle hooks consistent with other personas (Director, Configurator, Actor).
acceptance:
  - The moderator lifecycle exposes `moderator_lifecycle_*` entry points mirroring the naming pattern used by other modules.
  - Primary states include at least: Collect (gather per-event telemetry), Aggregate (batch/summarize), Emit (write artifacts).
  - State modules communicate via typed contracts so new telemetry categories can be added without altering base lifecycle code.
verification:
  - unit/integration: lifecycle smoke test verifies state transitions run without dropping events and produce expected artifacts.
traces:
  code: []

## P4-F03 — MODERATOR CONFIGURATION (verbosity tiers)
status: META
owner: system
req_type: FUNCTIONAL
phase: runtime
area: MODERATOR
priority: M
labels: [moderator, configuration]
rationale: Different debugging scenarios require varying levels of detail; the moderator must support configurable verbosity.
acceptance:
  - The moderator exposes configuration to select event categories (movement, AIU, solver, errors) and verbosity tiers (summary, detailed, raw).
  - Configuration can be adjusted at runtime (per simulation) and persists into emitted artifacts.
verification:
  - unit: configuration toggles produce expected changes in output volume/content.
traces:
  code: []

## P4-F04 — MODERATOR ASCII RENDERER (demo UI)
status: active
owner: system
req_type: FUNCTIONAL
phase: runtime
area: MODERATOR.UI
priority: H
labels: [moderator, ascii, demo]
rationale: The MVP demo relies on a clear, terminal-friendly visualization so observers can follow simulation progress without inspecting raw logs.
acceptance:
  - Each tick the moderator renders an ASCII surface map that spans the active surface bounds (including organic silhouettes), marking walkable regions, obstacles, ambulatory actors, and internal barriers with distinct glyphs.
  - Below the visualization, the moderator prints per-tick telemetry rows (tick id, directive hint, dispatch tiers, outcomes) aligned with the visual frame.
  - Rendering fits within standard terminal dimensions (80x24) or gracefully paginates/trims while preserving the most recent ticks.
  - Rendering is deterministic: given the same tick sequence, the ASCII output is identical so CI recordings and demos remain reproducible.
verification:
  - integration: running the orchestrator demo in a terminal captures an ASCII timeline showing actor movement and matching telemetry rows for at least three ticks.
traces:
  code: []
